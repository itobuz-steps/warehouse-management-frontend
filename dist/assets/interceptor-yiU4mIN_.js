import{a as l}from"./index-C0eOhpfv.js";import{c as u}from"./config-vXPTaLOK.js";navigator.onLine||(window.location.href="./connection-out.html");const s=l.create({baseURL:`${u.BASE_URL}/user`});s.interceptors.request.use(e=>{const t=localStorage.getItem("access_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e));let a=!1,c=[];const i=(e,t=null)=>{c.forEach(n=>{e?n.reject(e):n.resolve(t)}),c=[]};s.interceptors.response.use(e=>e,async e=>{const t=e.config;if((e.code==="ECONNABORTED"||e.message==="Network Error")&&(window.location.href="./connection-out.html"),e.response&&e.response.status>=500&&(window.location.href="./connection-out.html"),e.response&&e.response.status===401&&!t._retry){if(a)return new Promise(function(o,r){c.push({resolve:o,reject:r})}).then(o=>(t.headers=t.headers||{},t.headers.authorization="Bearer "+o,s(t))).catch(o=>Promise.reject(o));t._retry=!0,a=!0;const n=localStorage.getItem("refresh_token");try{const o=await l.post(`${u.AUTH_BASE_URL}/refresh`,{},{headers:{Authorization:`Bearer ${n}`}}),r=o.data.data.accessToken||o.data.data.access_token;return r?(localStorage.setItem("access_token",r),s.defaults.headers.common.Authorization="Bearer "+r,s.defaults.headers.common.authorization="Bearer "+r,i(null,r),s(t)):(i(new Error("No access token in refresh response"),null),window.location.href="./login.html",Promise.reject(new Error("No access token in refresh response")))}catch(o){return i(o,null),window.location.href="./login.html",Promise.reject(o)}finally{a=!1}}return Promise.reject(e)});export{s as a};
