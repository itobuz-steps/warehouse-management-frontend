import"../modulepreload-polyfill-B5Qt9EMX.js";import{g as F,a as N}from"../injectNotificationCanvas-C6as7mfK.js";/* empty css                */import"../bootstrap.esm-C02OvDcj.js";import{a as d}from"../interceptor-D8J117qD.js";import{c as u}from"../config-D1K7ByuX.js";import{T as D}from"../index-C0eOhpfv.js";import{C as w,B as j,a as P,b as W,L as G,p as Q,c as z,D as J,A as Z,d as K,e as V,P as X}from"../chart-Q_aq-WEB.js";const e={addManagerButton:document.querySelector(".add-manager-btn"),addManagerForm:document.querySelector(".add-manager-form"),addWarehouseForm:document.querySelector(".add-warehouse-form"),addWarehouseButton:document.querySelector(".add-warehouse-btn"),addManagerOptions:document.querySelector(".managers-option"),lineGraph:document.querySelector("#lineGraph"),barGraph:document.querySelector("#barGraph"),pieChart:document.querySelector("#pieChart"),lineChart:document.querySelector("#lineChart"),warehouseSelect:document.querySelector("#warehouseSelect"),toastSection:document.getElementById("toastSection"),carouselItems:document.getElementById("carouselItems"),salesInput:document.querySelector("#salesInput"),purchaseInput:document.querySelector("#purchaseInput"),inventoryInput:document.querySelector("#inventoryInput"),purchaseQuantity:document.querySelector("#purchaseQuantity"),saleQuantity:document.querySelector("#saleQuantity"),lowStockTable:document.querySelector("#lowStockTableBody"),cancelledTable:document.querySelector("#cancelledProductsTableBody"),adjustmentTable:document.querySelector("#adjustedProductsTableBody"),shipmentInput:document.querySelector("#shipmentInput"),lowStockTableCard:document.querySelector(".low-stock-table-card"),adjustmentTableCard:document.querySelector(".adjustment-table-card "),cancelledTableCard:document.querySelector(".cancelled-table-card"),recentActivityList:document.querySelector("#recentActivityList"),topFiveExport:document.querySelector("#exportTop5"),categoryExport:document.querySelector("#exportCategory"),transactionsExport:document.querySelector("#exportTransactions"),chartCard:document.querySelectorAll(".chart-card"),noDashboardBox:document.querySelector(".no-dashboard-box"),modeRadios:document.querySelectorAll('input[name="mode"]'),dateGroup:document.getElementById("dateGroup"),fromInput:document.getElementById("fromDate"),toInput:document.getElementById("toDate"),selectedMode:document.querySelector('input[name="mode"]:checked'),weekly:document.getElementById("weekly")},M=new D,L=document.getElementById("toastSection"),Y=async t=>{try{t.preventDefault();const n=new FormData(t.target).get("email"),o=await d.post(`${u.AUTH_BASE_URL}/signup`,{email:n});L.innerHTML=M.successToast(o.data.message)}catch(a){L.innerHTML=M.errorToast(a.response.data.message)}finally{setTimeout(()=>{L.innerHTML=""},3e3)}};w.register(j,P,W,G,Q,z,J,Z,K,V,X);const i=new D;let A=null,v=null,E=null,B=null;const H=async t=>{try{if(!t){e.chartCard.style.display="none";return}const n=(await d.get(`${u.DASHBOARD_BASE_URL}/get-top-products/${t}`)).data.data,o=n.map(s=>s.productName),r=n.map(s=>s.totalQuantity);v&&v.destroy(),e.topFiveExport.setAttribute("data-json",JSON.stringify(n)),v=new w(e.barGraph,{type:"bar",data:{labels:o,datasets:[{data:r,label:"Quantity",backgroundColor:["#00A6A6","#0077B6","#FF6B6B","#FFD166","#06D6A0"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:"Products",color:"#015453",font:{size:15}}},y:{title:{display:!0,text:"Quantity",color:"#015453",font:{size:15}},beginAtZero:!0}},onClick:(s,c)=>{c.length&&(window.location.href=`./products.html?filter=warehouses&warehouseId=${t}`)}}})}catch(a){e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},I=async t=>{const a=await d.get(`${u.DASHBOARD_BASE_URL}/get-inventory-category/${t}`),n=a.data.data.map(r=>r._id),o=a.data.data.map(r=>r.totalProducts);E&&E.destroy(),E=new w(e.pieChart,{type:"doughnut",data:{labels:n,datasets:[{label:"Quantity",data:o,backgroundColor:["#66c59dff","#376dc0ff","#009494","#536a6aff","#0077B6","#48CAE4","#FFD166","#FF6B6B","#06D6A0","#8338EC","#FF9F1C","#F72585"],hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,onClick:(r,s)=>{s.length&&(window.location.href=`./products.html?filter=warehouses&warehouseId=${t}`)}}})},R=async t=>{try{const n=(await d.get(`${u.DASHBOARD_BASE_URL}/get-product-transaction/${t}`)).data.data,o=n.map(c=>c._id),r=n.map(c=>c.IN),s=n.map(c=>c.OUT);B&&B.destroy(),B=new w(e.lineChart,{type:"line",data:{labels:o,datasets:[{label:"Stock In",data:r,borderWidth:2,fill:!1,borderColor:"#00A6A6",backgroundColor:"#00A6A6"},{label:"Stock Out",data:s,borderWidth:2,fill:!1,borderColor:"#FF6B6B",backgroundColor:"#FF6B6B"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Last 7 Days (Daily)"}},scales:{x:{title:{display:!0,text:"Last 7 Days",color:"#015453",font:{size:15}}},y:{title:{display:!0,text:"Transactions",color:"#015453",font:{size:15}},ticks:{stepSize:1},beginAtZero:!0}}}})}catch(a){e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},k=async t=>{try{const n=(await d.get(`${u.DASHBOARD_BASE_URL}/get-transaction-stats/${t}`)).data.data;let o=0,r=0,s=0,c=0,l=0,m=0;n.sales&&(o=n.sales.totalSales||0,r=n.sales.saleQuantity||0),n.purchase&&(s=n.purchase.totalPurchase||0,c=n.purchase.purchaseQuantity||0),n.inventory&&(l=n.inventory.totalQuantity||0),n.todayShipment&&(m=n.todayShipment.quantity||0),e.salesInput.innerText=`₹${o.toLocaleString("hi-IN")}`,e.saleQuantity.innerText=`Units sold: ${r.toLocaleString("hi-IN")}`,e.purchaseInput.innerText=`₹${s.toLocaleString("hi-IN")}`,e.purchaseQuantity.innerText=`Units purchased: ${c.toLocaleString("hi-IN")}`,e.inventoryInput.innerText=`${l.toLocaleString("hi-IN")} items left`,e.shipmentInput.innerText=`${m.toLocaleString("hi-IN")}`}catch(a){e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},$=async t=>{try{const n=(await d.get(`${u.DASHBOARD_BASE_URL}/get-low-stock-products/${t}`)).data.data.lowStockProducts;if(e.lowStockTable.innerHTML="",!n.length){e.lowStockTableCard.style.display="none";return}e.lowStockTableCard.style.display="block",n.forEach(o=>{const r=i.lowStockRow(o),s=document.createElement("tbody");s.innerHTML=r;const c=s.firstElementChild;c.style.cursor="pointer",c.addEventListener("click",()=>{window.location.href=`./products.html?filter=warehouses&warehouseId=${t}&productId=${o.productId}`}),e.lowStockTable.appendChild(c)})}catch(a){e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},q=async(t,a=5)=>{try{const o=(await d.get(`${u.DASHBOARD_BASE_URL}/get-cancelled-orders/${t}?limit=${a}`)).data.data;if(e.cancelledTable.innerHTML="",!o.length){e.cancelledTableCard.style.display="none";return}e.cancelledTableCard.style.display="block",o.forEach(r=>{const s=i.cancelledShipmentRow(r),c=document.createElement("tbody");c.innerHTML=s;const l=c.firstElementChild;l.style.cursor="pointer",l.addEventListener("click",()=>{window.location.href=`./products.html?filter=warehouses&warehouseId=${t}&productId=${r.productId}`}),e.cancelledTable.appendChild(l)})}catch(n){e.toastSection.innerHTML=i.errorToast(n.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},U=async(t,a=5)=>{try{const o=(await d.get(`${u.DASHBOARD_BASE_URL}/get-most-adjusted-products/${t}?limit=${a}`)).data.data;if(e.adjustmentTable.innerHTML="",!o.length){e.adjustmentTableCard.style.display="none";return}e.adjustmentTableCard.style.display="block",o.forEach(r=>{const s=i.adjustmentProductsRow(r),c=document.createElement("tbody");c.innerHTML=s;const l=c.firstElementChild;l.style.cursor="pointer",l.addEventListener("click",()=>{window.location.href=`./products.html?filter=warehouses&warehouseId=${t}&productId=${r.productId}`}),e.adjustmentTable.appendChild(l)})}catch(n){e.toastSection.innerHTML=i.errorToast(n.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},ee=()=>{e.lowStockTableCard.style.display="none",e.adjustmentTableCard.style.display="none",e.cancelledTableCard.style.display="none",e.noDashboardBox.style.display="flex",e.chartCard.forEach(t=>{t.style.display="none"})},te=()=>{e.noDashboardBox.style.display="none"},_=async t=>{try{if(!t)return;const n=(await d.get(`${u.TRANSACTION_BASE_URL}/warehouse-specific-transaction/${t}?page=1&limit=10`)).data.data.transactions||[];if(e.recentActivityList.innerHTML="",!n.length){e.recentActivityList.innerHTML=i.noRecentActivity();return}n.forEach(o=>{let r="Item";o.product?.productName?r=o.product.productName:o.product?.name&&(r=o.product.name);let s=0;o.quantity!==null&&o.quantity!==void 0?s=o.quantity:o.qty!==null&&o.qty!==void 0&&(s=o.qty);let c="System";o.performedBy?.name?c=o.performedBy.name:o.performedBy?.fullName&&(c=o.performedBy.fullName);let l="UNKNOWN";o.type?l=o.type:o._doc?.type&&(l=o._doc.type);let m;o.updatedAt?m=o.updatedAt:m=o.createdAt;let y="";m&&(y=new Date(m).toLocaleString());let h="info",S=`<strong>${r}</strong> (${s} units)`;if(l==="IN"){const p=i.transactionIN(r,s);h=p.dotClass,S=p.actionText}else if(l==="OUT"){const p=i.transactionOUT(r,s);h=p.dotClass,S=p.actionText}else if(l==="TRANSFER"){let p="";o.destinationWarehouse?.name?p=o.destinationWarehouse.name:o.sourceWarehouse?.name&&(p=o.sourceWarehouse.name);const C=i.transactionTRANSFER(r,s,p);h=C.dotClass,S=C.actionText}else if(l==="ADJUSTMENT"||l==="ADJ"){const p=i.transactionADJUSTMENT(r,s);h=p.dotClass,S=p.actionText}e.recentActivityList.innerHTML+=i.recentActivityItem({performedBy:c,actionText:S,time:y,dotClass:h})})}catch(a){e.recentActivityList.innerHTML=i.noRecentActivity(),e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}e.recentActivityList.addEventListener("click",a=>{a.target.closest(".activity-item")&&(window.location.href="http://localhost:8080/pages/reports.html")})},ae=async t=>{try{const a=await F(),n=await N();return a.role==="manager"&&e.addManagerButton.remove(),n.length?(te(),t.innerHTML="",t.innerHTML=i.warehouseOption(n[0],!0),n.slice(1).forEach(o=>{t.insertAdjacentHTML("beforeend",i.warehouseOption(o))}),!0):(ee(),e.noDashboardBox.innerHTML=i.noWarehouseMessage(a.role),!1)}catch(a){e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},O=async t=>{try{if(!t){e.chartCard.style.display="none";return}const n=(await d.get(`${u.DASHBOARD_BASE_URL}/get-top-selling-products/${t}`)).data.data;e.carouselItems.innerHTML="",n.forEach((o,r)=>{let s="";r===0&&(s="active");const c=i.carouselItem(t,o,s);e.carouselItems.innerHTML+=c})}catch(a){e.toastSection.innerHTML=i.errorToast(a.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},f=async(t,a=null,n=null,o=null)=>{try{let r=`${u.DASHBOARD_BASE_URL}/get-profit-loss?warehouseId=${t}`;a?r+=`&period=${a}`:n&&o&&(r+=`&from=${n}&to=${o}`);const c=(await d.get(r)).data.data,l=c.map(y=>y.label),m=c.map(y=>y.net);A&&A.destroy(),A=new w(e.lineGraph,{type:"line",data:{labels:l,datasets:[{label:"Net Amount",data:m,borderWidth:2,fill:!1,borderColor:"#055d5dff",backgroundColor:"#076e6eff"}]},options:{responsive:!0,tension:.4,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Profit and Loss"}},scales:{x:{title:{display:!0,text:"Days",color:"#015453",font:{size:15}}},y:{title:{display:!0,text:"Net Amount",color:"#015453",font:{size:15}},ticks:{stepSize:1},beginAtZero:!0}},datasets:{line:{segment:{borderColor:y=>y.p1.parsed.y>=0?"#0b9671ff":"#ec0d3dff"}}}}})}catch(r){e.toastSection.innerHTML=i.errorToast(r.message),setTimeout(()=>{e.toastSection.innerHTML=""},3e3)}},oe=async()=>{try{const t=e.warehouseSelect.value,a=await d.get(`${u.DASHBOARD_BASE_URL}/get-product-transaction-chart-data/${t}`,{responseType:"blob"}),n=new Blob([a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="weekly-transactions.xlsx",r.click(),window.URL.revokeObjectURL(o)}catch(t){console.error(t)}},ne=async()=>{try{const t=e.warehouseSelect.value,a=await d.get(`${u.DASHBOARD_BASE_URL}/get-inventory-category-chart-data/${t}`,{responseType:"blob"}),n=new Blob([a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="inventory-category.xlsx",r.click(),window.URL.revokeObjectURL(o)}catch(t){console.error(t)}},re=async()=>{try{const t=e.warehouseSelect.value,a=await d.get(`${u.DASHBOARD_BASE_URL}/get-top-products-chart-data/${t}`,{responseType:"blob"}),n=new Blob([a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),o=window.URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="top-products.xlsx",r.click(),window.URL.revokeObjectURL(o)}catch(t){console.error(t)}};e.addManagerForm.addEventListener("submit",Y);document.addEventListener("DOMContentLoaded",async()=>{if(await ae(e.warehouseSelect)){const a=e.warehouseSelect.value;await H(a),await I(a),await R(a),await k(a),await $(a),await q(a),await U(a),await _(a),await O(a),await f(a,"week"),e.dateGroup.style.display="none"}});e.warehouseSelect.addEventListener("change",async()=>{e.weekly.checked=!0,e.dateGroup.style.display="none",e.fromInput.value="",e.toInput.value="";const t=e.warehouseSelect.value;await H(t),await I(t),await R(t),await k(t),await $(t),await q(t),await U(t),await _(t),await O(t),await f(t,"week");const a=document.querySelector('input[name="mode"]:checked').value;a==="custom"?(T.style.display="flex",g.value&&b.value&&await f(t,null,g.value,b.value)):(T.style.display="none",await f(t,a))});e.topFiveExport.addEventListener("click",re);e.categoryExport.addEventListener("click",ne);e.transactionsExport.addEventListener("click",oe);const se=e.modeRadios,T=e.dateGroup,g=e.fromInput,b=e.toInput,ce=async()=>{const t=document.querySelector('input[name="mode"]:checked').value,a=e.warehouseSelect.value;t==="custom"?T.style.display="flex":(T.style.display="none",await f(a,t))};se.forEach(t=>{t.addEventListener("change",ce)});const x=async()=>{const t=e.warehouseSelect.value,a=g.value,n=b.value;!a||!n||await f(t,null,a,n)};g.addEventListener("change",x);b.addEventListener("change",x);
