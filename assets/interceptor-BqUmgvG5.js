import{a as l}from"./index-C0eOhpfv.js";import{c as u}from"./config-D1K7ByuX.js";const o=l.create({baseURL:`${u.BASE_URL}/user`});o.interceptors.request.use(e=>{const r=localStorage.getItem("access_token");return r&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));let n=!1,i=[];const c=(e,r=null)=>{i.forEach(a=>{e?a.reject(e):a.resolve(r)}),i=[]};o.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.code==="ECONNABORTED"||e.message==="Network Error")return console.warn("API call failed:",e.message),Promise.reject(new Error("Server Unreachable"));if(e.response&&e.response.status>=500)return console.warn("Server error:",e.response.status),Promise.reject(new Error("Server Error"));if(e.response&&e.response.status===401&&!r._retry){if(n)return new Promise(function(s,t){i.push({resolve:s,reject:t})}).then(s=>(r.headers=r.headers||{},r.headers.authorization="Bearer "+s,o(r))).catch(s=>Promise.reject(s));r._retry=!0,n=!0;const a=localStorage.getItem("refresh_token");try{const s=await l.post(`${u.AUTH_BASE_URL}/refresh`,{},{headers:{Authorization:`Bearer ${a}`}}),t=s.data.data.accessToken||s.data.data.access_token;return t?(localStorage.setItem("access_token",t),o.defaults.headers.common.Authorization="Bearer "+t,o.defaults.headers.common.authorization="Bearer "+t,c(null,t),o(r)):(c(new Error("No access token in refresh response"),null),console.warn("Authentication failed - no access token"),Promise.reject(new Error("No access token in refresh response")))}catch(s){return c(s,null),window.location.href="./login.html",Promise.reject(s)}finally{n=!1}}return Promise.reject(e)});export{o as a};
