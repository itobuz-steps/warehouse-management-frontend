import{a as u}from"./index-C0eOhpfv.js";import{c as l}from"./config-D1K7ByuX.js";const a=u.create({baseURL:`${l.BASE_URL}/user`});a.interceptors.request.use(e=>{const r=localStorage.getItem("access_token");return r&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));let n=!1,i=[];const c=(e,r=null)=>{i.forEach(o=>{e?o.reject(e):o.resolve(r)}),i=[]};a.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.code==="ECONNABORTED"||e.message==="Network Error")return console.warn("API call failed:",e.message),Promise.reject(new Error("Server Unreachable"));if(e.response&&e.response.status>=500)return console.warn("Server error:",e.response.status),Promise.reject(new Error("Server Error"));if(e.response&&e.response.status===401&&!r._retry){if(n)return new Promise(function(s,t){i.push({resolve:s,reject:t})}).then(s=>(r.headers=r.headers||{},r.headers.authorization="Bearer "+s,a(r))).catch(s=>Promise.reject(s));r._retry=!0,n=!0;const o=localStorage.getItem("refresh_token");try{const s=await u.post(`${l.AUTH_BASE_URL}/refresh`,{},{headers:{Authorization:`Bearer ${o}`}}),t=s.data.data.accessToken||s.data.data.access_token;return t?(localStorage.setItem("access_token",t),a.defaults.headers.common.Authorization="Bearer "+t,a.defaults.headers.common.authorization="Bearer "+t,c(null,t),a(r)):(c(new Error("No access token in refresh response"),null),console.warn("Authentication failed - no access token"),Promise.reject(new Error("No access token in refresh response")))}catch(s){return c(s,null),console.warn("Authentication refresh failed:",s.message),Promise.reject(s)}finally{n=!1}}return Promise.reject(e)});export{a};
