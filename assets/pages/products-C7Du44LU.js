import"../modulepreload-polyfill-B5Qt9EMX.js";import{g as m,a as D}from"../injectNotificationCanvas-CHxfdlUe.js";import{p as e,i as R}from"../imageCarousel-Dy8HoRmN.js";import{M as y}from"../bootstrap.esm-C02OvDcj.js";import{p,s as L,a as n,r as U,m as F,w as b,b as T,c as q,d as x,e as B,u as P,f as I,o as H,g as S}from"../productGridRenderer-SpLrnwr9.js";import{q as N,f as Q,a as W,b as A,c as _,d as G,u as j,e as z,g as O,h as V}from"../productApiHelper-BkZWoKR_.js";import"../index-C0eOhpfv.js";import"../interceptor-B7g-R4Lu.js";import"../config-E-HGwCPq.js";const M=async()=>{try{const t=await m(),a=await D();if(!a.length){e.warehouseSelect.innerHTML='<option value="">No warehouses assigned</option>',p([],e.warehouseSelect,!0),L();return}if(t.role==="admin")e.warehouseSelect.innerHTML='<option value="">All Warehouses</option>',p(a,e.warehouseSelect,!0);else if(p(a,e.warehouseSelect),!new URLSearchParams(window.location.search).get("warehouseId")){const l=a[0];e.warehouseSelect.value=l._id;const u=new URL(window.location);u.searchParams.set("warehouseId",l._id),window.history.replaceState({},"",u)}const d=new URLSearchParams(window.location.search).get("warehouseId");d&&(e.warehouseSelect.value=d)}catch(t){console.error(t),n("error","Error fetching warehouses")}};let w=null;const E=()=>{e.modal.classList.add("hidden"),U(),w=null};e.closeModalBtn.addEventListener("click",E);window.addEventListener("click",t=>{t.target===e.modal&&E()});e.cancelDeleteBtn.addEventListener("click",()=>{e.confirmDeleteModal.classList.add("hidden")});window.addEventListener("click",t=>{t.target===e.confirmDeleteModal&&e.confirmDeleteModal.classList.add("hidden")});const C=async t=>{w=t._id;const a=new URL(window.location);a.searchParams.set("productId",w),window.history.replaceState({},"",a),(await m()).role!=="admin"?e.deleteProductBtn.style.display="none":e.deleteProductBtn.style.display="block",R({images:t.productImage}),e.modalProductName.textContent=t.name,e.modalDescription.textContent=t.description||"No description available.",e.modalPrice.textContent=t.price??"N/A",e.modalCategory.textContent=t.category??"Not Categorized",e.modalMarkup.textContent=t.markup??"10",e.modalMarkupPrice.textContent=(t.price+t.price*(t.markup||10)/100).toFixed(2),await $(w);const o=await N(w),d=URL.createObjectURL(o.data);e.qrCodeItem.src=d,e.modal.classList.remove("hidden")};async function $(t){try{let a=new URLSearchParams(window.location.search);if(a.get("filter")!=="warehouses"){e.quantitySection.innerHTML="";return}const o=await m();e.quantitySection.innerHTML="Loading quantity...",a=new URLSearchParams(window.location.search);const d=a.get("warehouseId")||o.warehouseId;if(o.role==="manager"){const c=await Q(t,d);e.quantitySection.innerHTML=F(c.data.data[0])}else{let h=(await W(t)).data.data[0].quantity??0;const l=await A(t),u=b(l.data.data);e.quantitySection.innerHTML=`
        <div class="overview-card mb-2 border-success-subtle">
          <p class="m-0 p-0"><strong>Total Quantity:</strong> ${h}</p>
        </div>
        <hr/>
        <div class="warehouse-list-container justify-content-evenly px-2">
          ${u}
        </div>
      `}}catch{e.quantitySection.innerHTML="Error loading quantity."}}document.addEventListener("click",t=>{const a=t.target.closest(".edit-limit-btn");if(!a)return;e.limitQuantityId.value=a.dataset.id,e.limitInput.value=a.dataset.limit,new y(e.limitModal).show()});e.saveLimitBtn.addEventListener("click",re);e.editProductBtn.addEventListener("click",Z);e.editProductForm.addEventListener("submit",t=>{ee(t,w)});e.deleteProductBtn.addEventListener("click",te);e.confirmDeleteBtn.addEventListener("click",()=>{ae(w)});const r={page:1,limit:12,search:"",category:"",sort:"",warehouseId:"",filter:"products",user:null};let g=!1;const J=async()=>{const t=new URL(window.location);r.filter=t.searchParams.get("filter")||"products",r.warehouseId=t.searchParams.get("warehouseId")||"",e.filterTypeSelect.value=r.filter,P(r.filter);try{r.user=await m()}catch(a){console.error(a),n("error","Could not load user");return}if(I(),K(),r.filter==="warehouses"&&(await M(),!r.warehouseId&&e.warehouseSelect.value)){r.warehouseId=e.warehouseSelect.value;const a=new URL(window.location);a.searchParams.set("warehouseId",r.warehouseId),window.history.replaceState({},"",a)}await i({page:1,warehouseId:r.warehouseId})},K=()=>{g||(g=!0,e.searchInput.addEventListener("input",t=>{i({search:t.target.value.trim(),page:1})}),e.categoryFilter.addEventListener("change",t=>{i({category:t.target.value,page:1})}),e.sortSelect.addEventListener("change",t=>{i({sort:t.target.value,page:1})}),e.warehouseSelect?.addEventListener("change",t=>{const a=t.target.value;r.warehouseId=a;const s=new URL(window.location);a?s.searchParams.set("warehouseId",a):s.searchParams.delete("warehouseId"),window.history.replaceState({},"",s),i({warehouseId:a,page:1})}),e.filterTypeSelect.addEventListener("change",async()=>{r.filter=e.filterTypeSelect.value,P(r.filter),I();const t=new URL(window.location);t.searchParams.set("filter",r.filter),t.searchParams.delete("warehouseId"),window.history.replaceState({},"",t),r.page=1,r.warehouseId="",r.filter==="warehouses"&&(await M(),e.warehouseSelect.value&&(r.warehouseId=e.warehouseSelect.value,t.searchParams.set("warehouseId",r.warehouseId),window.history.replaceState({},"",t))),await i({page:1,warehouseId:r.warehouseId})}))},i=async(t={})=>{e.productGrid.classList.remove("empty","error"),e.productGrid.classList.add("product-grid");try{if(Object.assign(r,t),r.user.role==="manager"&&r.filter==="warehouses"&&!r.warehouseId){f([]),v(0);return}const a={page:r.page,limit:r.limit,search:r.search||void 0,category:r.category||void 0,sort:r.sort||void 0,warehouseId:r.warehouseId||void 0};let s;r.filter==="warehouses"?s=await _(a):s=await G(a);const{products:o=[],totalPages:d=0,currentPage:c=1}=s.data.data||{};r.page=c,f(o),v(d);const l=new URL(window.location).searchParams.get("productId");if(l){const u=o.find(k=>k._id===l);u&&await C(u)}}catch(a){console.error(a),T()}},f=t=>{q({container:e.productGrid,products:t,createCardHTML:B,onViewDetails:C,emptyState:L})},v=t=>{x({container:e.pagination,currentPage:r.page,totalPages:t,onPageChange:a=>{i({page:a,warehouseId:r.warehouseId})}})},X=()=>{e.addProductsButton.addEventListener("click",H),e.closeModalButton.addEventListener("click",S),e.addProductForm.addEventListener("submit",Y)},Y=async t=>{t.preventDefault();const a=new FormData,s=await m();a.append("name",e.addProductForm.productName.value),a.append("category",e.addProductForm.productCategory.value),a.append("description",e.addProductForm.productDescription.value),a.append("price",e.addProductForm.productPrice.value),a.append("markup",e.addProductForm.markup.value),a.append("createdBy",s._id),[...e.addProductForm.productImage.files].forEach(o=>a.append("productImage",o));try{const o=await V(a);if(!o.data.success)return n("error","Failed to add product");n("success",o.data.message),e.addProductForm.reset(),S();const c=new URLSearchParams(window.location.search).get("warehouseId");i({warehouseId:c,page:1})}catch(o){console.error(o),n("error",o.response.data.message)}};function Z(){e.editName.value=e.modalProductName.textContent,e.editDescription.value=e.modalDescription.textContent,e.editCategory.value=e.modalCategory.textContent,e.editPrice.value=e.modalPrice.textContent,e.editMarkup.value=e.modalMarkup.textContent,e.editModal.classList.remove("hidden")}e.closeEditModal.addEventListener("click",()=>e.editModal.classList.add("hidden"));window.addEventListener("click",t=>{t.target===e.editModal&&e.editModal.classList.add("hidden")});const ee=async(t,a)=>{t.preventDefault();const s=new FormData;s.append("name",e.editName.value),s.append("description",e.editDescription.value),s.append("category",e.editCategory.value),s.append("price",e.editPrice.value),s.append("markup",e.editMarkup.value);const o=e.editImages.files;for(let d=0;d<o.length;d++)s.append("productImage",o[d]);try{const d=await z(s,a);e.editModal.classList.add("hidden"),e.modal.classList.add("hidden");const h=new URLSearchParams(window.location.search).get("warehouseId");i({warehouseId:h,page:1}),n("success",d.data.message)}catch(d){console.error(d),n("error",d.response.data.message)}};function te(){e.confirmDeleteModal.classList.remove("hidden")}async function ae(t){try{const a=await O(t);e.confirmDeleteModal.classList.add("hidden"),e.modal.classList.add("hidden");const o=new URLSearchParams(window.location.search).get("warehouseId");i({warehouseId:o,page:1}),n("success",a.data.message)}catch(a){console.error(a),n("error",a.response.data.message)}}async function re(){try{const t=await j(e.limitQuantityId.value,e.limitInput.value);y.getInstance(e.limitModal).hide(),n("success",t.data.message),e.modal.classList.add("hidden")}catch(t){n("error",t.response.data.message)}}X();await J();
